<!-- A/B Audio Player – customized for before/after -->
<div class="abp player__wrapper light-mode"
     data-audio-a="before.wav"
     data-audio-b="after.wav">
  <div class="abp__progress">
    <div class="abp__progressFill"></div>
  </div>

  <div class="abp__abControls">
    <button class="abp__btn" data-role="A" disabled>Before</button>
    <button class="abp__btn" data-role="B" disabled>After</button>
  </div>

  <div class="abp__transport">
    <button class="abp__btn abp__play" data-role="play" disabled>▶️</button>
    <button class="abp__btn abp__stop" data-role="stop" disabled>⏹️</button>
  </div>
</div>

<style>
/* ====== Base Styles ====== */
.abp.player__wrapper {
  border-radius: 20px; padding:18px; max-width:520px; margin:12px auto;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
  transition: background 0.3s ease, color 0.3s ease;
}

/* Light / Dark Mode */
.abp.player__wrapper.light-mode {
  background:#f0f0f0; color:#000;
  box-shadow: 20px 20px 37px #cdcdcd, -20px -20px 37px #fff;
}
.abp.player__wrapper.dark-mode {
  background:#1b1b1b; color:#fff;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
}

/* Buttons */
.abp__abControls, .abp__transport {
  display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px;
}
.abp__btn {
  font-size:1rem; border:none; border-radius:10px; padding:.7rem 1rem;
  background:inherit; color:inherit;
  box-shadow:inset 5px 5px 10px rgba(0,0,0,0.2), inset -5px -5px 10px rgba(255,255,255,0.1);
  cursor:pointer; transition:.2s all;
}
.abp__btn:hover { transform:scale(1.03) }
.abp__btn:disabled { opacity:0.5; cursor:not-allowed }

/* Progress Bar */
.abp__progress {
  height:12px; width:100%; border-radius:10px; margin-bottom:18px; cursor:pointer;
  background:rgba(255,255,255,0.3);
}
.abp.player__wrapper.light-mode .abp__progressFill {
  background:linear-gradient(360deg,#2da87b,#34dcacfa);
}
.abp.player__wrapper.dark-mode .abp__progressFill {
  background:linear-gradient(360deg,#00ffb3,#00b37a);
}
.abp__progressFill { height:100%; width:0%; border-radius:10px; transition:width 0.05s linear; }
</style>

<script>
(function initABPlayers(){
  document.querySelectorAll('.abp.player__wrapper').forEach(function(wrapper){
    const btnBefore = wrapper.querySelector('button[data-role="A"]');
    const btnAfter = wrapper.querySelector('button[data-role="B"]');
    const btnPlay = wrapper.querySelector('button[data-role="play"]');
    const btnStop = wrapper.querySelector('button[data-role="stop"]');
    const progress = wrapper.querySelector('.abp__progress');
    const fill = wrapper.querySelector('.abp__progressFill');

    const aURL = wrapper.getAttribute('data-audio-a');
    const bURL = wrapper.getAttribute('data-audio-b');
    const soundA = new Audio(aURL), soundB = new Audio(bURL);
    soundA.preload = soundB.preload = "auto";
    document.body.append(soundA, soundB);

    let readyA = false, readyB = false;
    function checkReady(){
      if(readyA && readyB){ btnBefore.disabled = false; btnPlay.disabled = false; }
    }
    soundA.addEventListener('canplaythrough',()=>{ readyA=true; checkReady(); });
    soundB.addEventListener('canplaythrough',()=>{ readyB=true; checkReady(); });

    // Click to seek
    progress.addEventListener('click',function(e){
      const pct = (e.clientX - this.getBoundingClientRect().left) / this.offsetWidth;
      if(soundA.duration && soundB.duration){
        soundA.currentTime = soundB.currentTime = pct * soundA.duration;
        fill.style.width = (pct * 100) + '%';
      }
    });

    // Progress animation
    function step(){
      const active = !soundA.paused ? soundA : !soundB.paused ? soundB : null;
      if(active && active.duration) fill.style.width = ((active.currentTime / active.duration) * 100) + '%';
      requestAnimationFrame(step);
    }
    step();

    // Helper to sync and swap theme
    function playA(){
      wrapper.classList.remove('dark-mode'); wrapper.classList.add('light-mode');
      soundB.pause(); soundA.play();
      btnBefore.disabled=true; btnAfter.disabled=false;
    }
    function playB(){
      wrapper.classList.remove('light-mode'); wrapper.classList.add('dark-mode');
      soundA.pause(); soundB.play();
      btnAfter.disabled=true; btnBefore.disabled=false;
    }

    // Button events
    btnPlay.addEventListener('click',function(){
      if(soundA.paused && soundB.paused){
        playA();
        btnStop.disabled=false;
        this.textContent='⏸️';
      } else {
        soundA.pause(); soundB.pause(); this.textContent='▶️';
      }
    });

    btnBefore.addEventListener('click',()=>{ playA(); btnPlay.textContent='⏸️'; });
    btnAfter.addEventListener('click',()=>{ playB(); btnPlay.textContent='⏸️'; });

    btnStop.addEventListener('click',()=>{
      soundA.pause(); soundB.pause();
      soundA.currentTime=soundB.currentTime=0;
      fill.style.width='0%';
      btnBefore.disabled=false; btnAfter.disabled=true; btnPlay.textContent='▶️';
      btnStop.disabled=true;
      wrapper.classList.remove('dark-mode'); wrapper.classList.add('light-mode');
    });

    btnAfter.disabled = true;
    btnStop.disabled = true;
  });
})();
</script>
